<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>The vec3 Struct - ray-tracing in one weekend</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href=".././theme/style.css">

        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../chapters/introduce.html">Introduce</a></li><li class="chapter-item expanded "><a href="../chapters/chapter_1.html"><strong aria-hidden="true">1.</strong> Output an Image</a></li><li class="chapter-item expanded "><a href="../chapters/chapter_2.html" class="active"><strong aria-hidden="true">2.</strong> The vec3 Struct</a></li><li class="chapter-item expanded "><a href="../chapters/chapter_3.html"><strong aria-hidden="true">3.</strong> Rays, a Simple Camera, and Background</a></li><li class="chapter-item expanded "><a href="../chapters/chapter_4.html"><strong aria-hidden="true">4.</strong> Adding a Sphere</a></li><li class="chapter-item expanded "><a href="../chapters/chapter_5.html"><strong aria-hidden="true">5.</strong> Surface Normals and Multiple Objects</a></li><li class="chapter-item expanded "><a href="../chapters/chapter_6.html"><strong aria-hidden="true">6.</strong> Antialiasing</a></li><li class="chapter-item expanded "><a href="../chapters/chapter_7.html"><strong aria-hidden="true">7.</strong> Diffuse Materials</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">ray-tracing in one weekend</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/dupeiran001/rust-ray-tracing-in-one-weekend" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <h1 id="the-vec3-struct"><a class="header" href="#the-vec3-struct">The vec3 struct</a></h1>
<p>Every one having used Cuda or some framework should be familiar with vec3 or .etc.
Almost every graphic program have some structs for storing geometric vector or colors.
In many systems these vectors are 4D (3D plus a homogeneous coordinate for geometry,
and RGB plus an alpha transparency channel for colors). In our usage, three coordinates
suffices. We'll use the same struct <code>vec3</code> for colors, locations, directions, offsets, whatever.
Some people don’t like this because it doesn’t prevent you from doing something silly, like adding
color to a location. They have a good point, but we’re going to always take the “less code” route when
not obviously wrong. In spite of this, we do declare two aliases for <code>vec3</code>: <code>point3</code> and <code>color</code>.
We use them only to clarify intent and use.</p>
<h2 id="variables-and-methods"><a class="header" href="#variables-and-methods">Variables and Methods</a></h2>
<p>We need a new file for our <code>vec3</code> struct. To do this, create a new file in the same folder as <code>main.rs</code>,
naming <code>vec3.rs</code>, and add</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>mod vec3;
<span class="boring">}</span></code></pre></pre>
<p>to the top of the <code>main.rs</code>.</p>
<p>Here is my implementation of <code>Vec3</code> struct</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use core::ops::*;

#[derive(Debug)]
pub struct Vec3 {
    e: (f64, f64, f64),
}

pub type Point3 = Vec3;
pub type Color = Vec3;

impl Vec3 {
    pub fn new() -&gt; Vec3 {
        Vec3 {
            e: (0f64, 0f64, 0f64),
        }
    }

    pub fn from(e0: f64, e1: f64, e2: f64) -&gt; Vec3 {
        Vec3 { e: (e0, e1, e2) }
    }

    pub fn x(&amp;self) -&gt; &amp;f64 {
        &amp;self.e.0
    }

    pub fn y(&amp;self) -&gt; &amp;f64 {
        &amp;self.e.1
    }

    pub fn z(&amp;self) -&gt; &amp;f64 {
        &amp;self.e.2
    }

    pub fn length(&amp;self) -&gt; f64 {
        self.length_squared().sqrt()
    }

    pub fn length_squared(&amp;self) -&gt; f64 {
        self.x() * self.x() + self.y() * self.y() + self.z() * self.z()
    }
}
<span class="boring">}</span></code></pre></pre>
<p>It's safe and convenient to implement clone and copy for our <code>Vec3</code> struct,
as it can be cloned by only clone the memory, it's completely safe:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl Clone for Vec3 {
    fn clone(&amp;self) -&gt; Self {
        Self {
            e: (*self.x(), *self.y(), *self.z()),
        }
    }
}

impl Copy for Vec3 {}
<span class="boring">}</span></code></pre></pre>
<p>And then, implement some operator trait for it</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span>
<span class="boring">fn main() {
</span>impl Neg for Vec3 {
    type Output = Vec3;

    fn neg(self) -&gt; Self::Output {
        Self {
            e: (-self.x(), -self.y(), -self.z()),
        }
    }
}

impl AddAssign for Vec3 {
    fn add_assign(&amp;mut self, rhs: Self) {
        self.e.0 += rhs.x();
        self.e.1 += rhs.y();
        self.e.2 += rhs.z();
    }
}

impl MulAssign&lt;f64&gt; for Vec3 {
    fn mul_assign(&amp;mut self, rhs: f64) {
        self.e.0 *= rhs;
        self.e.1 *= rhs;
        self.e.2 *= rhs;
    }
}

impl DivAssign&lt;f64&gt; for Vec3 {
    fn div_assign(&amp;mut self, rhs: f64) {
        self.e.0 *= 1f64 / rhs;
        self.e.1 *= 1f64 / rhs;
        self.e.2 *= 1f64 / rhs;
    }
}

impl Index&lt;i32&gt; for Vec3 {
    type Output = f64;

    fn index(&amp;self, index: i32) -&gt; &amp;Self::Output {
        assert!(index &lt;= 2 &amp;&amp; index &gt;= 0);
        match index {
            0 =&gt; self.x(),
            1 =&gt; self.y(),
            2 =&gt; self.z(),
            _ =&gt; unreachable!(),
        }
    }
}
<span class="boring">}</span></code></pre></pre>
<p>as well as some tests:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[cfg(test)]
mod test {
    use super::Vec3;

    #[test]
    fn basic_ops() {
        let vec1 = Vec3::from(1f64, 2f64, 3f64);
        assert_eq!(1f64, *vec1.x());
        assert_eq!(2f64, *vec1.y());
        assert_eq!(3f64, *vec1.z());

        assert_eq!(1f64, vec1[0]);
        assert_eq!(2f64, vec1[1]);
        assert_eq!(3f64, vec1[2]);

        let vec2 = -vec1;

        assert_eq!(-1f64, *vec2.x());
        assert_eq!(-2f64, *vec2.y());
        assert_eq!(-3f64, *vec2.z());

        let mut vec3 = Vec3::from(5f64, 3f64, 1f64);
        vec3 += vec2;

        assert_eq!(4f64, *vec3.x());
        assert_eq!(1f64, *vec3.y());
        assert_eq!(-2f64, *vec3.z());

        vec3 *= 2f64;
        assert_eq!(8f64, *vec3.x());
        assert_eq!(2f64, *vec3.y());
        assert_eq!(-4f64, *vec3.z());

        assert_eq!(9f64, Vec3::from(1f64, 2f64, 2f64).length_squared());
        assert_eq!(3f64, Vec3::from(1f64, 2f64, 2f64).length());

        vec3 /= 2f64;
        assert_eq!(4f64, *vec3.x());
        assert_eq!(1f64, *vec3.y());
        assert_eq!(-2f64, *vec3.z());
    }
}

<span class="boring">}</span></code></pre></pre>
<p>We use <code>f64</code> here, but some ray tracer use <code>f32</code>, that is float. Either is fine.</p>
<h2 id="vec3-utility-functions"><a class="header" href="#vec3-utility-functions"><code>Vec3</code> utility Functions</a></h2>
<p>The second part of the file contains vector utility functions.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl PartialEq for Vec3 {
    fn eq(&amp;self, other: &amp;Self) -&gt; bool {
        self.x() == other.x() &amp;&amp; self.y() == other.y() &amp;&amp; self.z() == other.z()
    }
}

impl Display for Vec3 {
    fn fmt(&amp;self, f: &amp;mut std::fmt::Formatter&lt;'_&gt;) -&gt; std::fmt::Result {
        f.write_str(format!(&quot;{} {} {}&quot;, self[0], self[1], self[2]).as_str())
    }
}

impl Add for Vec3 {
    type Output = Self;

    fn add(self, rhs: Self) -&gt; Self::Output {
        Self {
            e: (self.x() + rhs.x(), self.y() + rhs.y(), self.z() + rhs.z()),
        }
    }
}

impl Sub for Vec3 {
    type Output = Self;

    fn sub(self, rhs: Self) -&gt; Self::Output {
        Self {
            e: (self.x() - rhs.x(), self.y() - rhs.y(), self.z() - rhs.z()),
        }
    }
}

impl Mul for Vec3 {
    type Output = Self;

    fn mul(self, rhs: Self) -&gt; Self::Output {
        Self {
            e: (self.x() * rhs.x(), self.y() * rhs.y(), self.z() * rhs.z()),
        }
    }
}

impl Mul&lt;f64&gt; for Vec3 {
    type Output = Self;

    fn mul(self, rhs: f64) -&gt; Self::Output {
        Self {
            e: (self.x() * rhs, self.y() * rhs, self.z() * rhs),
        }
    }
}

impl Mul&lt;Vec3&gt; for f64 {
    type Output = Vec3;

    fn mul(self, rhs: Vec3) -&gt; Self::Output {
        rhs * self
    }
}

impl Div&lt;f64&gt; for Vec3 {
    type Output = Vec3;

    fn div(self, rhs: f64) -&gt; Self::Output {
        (1f64 / rhs) * self
    }
}

impl Vec3 {
    pub fn dot(lhs: &amp;Vec3, rhs: &amp;Vec3) -&gt; f64 {
        lhs.x() * rhs.x() + lhs.y() * rhs.y() + lhs.z() * rhs.z()
    }

    pub fn cross(lhs: &amp;Vec3, rhs: &amp;Vec3) -&gt; Vec3 {
        Self {
            e: (
                lhs.y() * rhs.z() - lhs.z() * rhs.y(),
                lhs.z() * rhs.x() - lhs.x() * rhs.z(),
                lhs.x() * rhs.y() - lhs.y() * rhs.x(),
            ),
        }
    }

    pub fn unit_vector(&amp;self) -&gt; Self {
        *self / self.length()
    }
}

<span class="boring">}</span></code></pre></pre>
<p>And it's test:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span>
<span class="boring">fn main() {
</span>    #[test]
    fn utility_funtions() {
        let vec1 = Vec3::from(1f64, 2f64, 3f64);

        assert_eq!(String::from(&quot;1 2 3&quot;), vec1.to_string());

        let vec2 = Vec3::from(2f64, 3f64, 4f64);
        let vec3 = vec1 + vec2;
        assert_eq!(3f64, *vec3.x());
        assert_eq!(5f64, *vec3.y());
        assert_eq!(7f64, *vec3.z());

        let vec4 = vec3 - vec2;
        assert_eq!(vec4.x(), vec1.x());
        assert_eq!(vec4.y(), vec1.y());
        assert_eq!(vec4.z(), vec1.z());

        let vec5 = vec4 * vec2;
        assert_eq!(2f64, *vec5.x());
        assert_eq!(6f64, *vec5.y());
        assert_eq!(12f64, *vec5.z());

        let vec6 = vec4 * 2f64;
        assert_eq!(2f64, *vec6.x());
        assert_eq!(4f64, *vec6.y());
        assert_eq!(6f64, *vec6.z());

        let vec6 = 2f64 * vec4;
        assert_eq!(2f64, *vec6.x());
        assert_eq!(4f64, *vec6.y());
        assert_eq!(6f64, *vec6.z());

        let vec7 = vec6 / 2f64;
        assert_eq!(1f64, *vec7.x());
        assert_eq!(2f64, *vec7.y());
        assert_eq!(3f64, *vec7.z());

        assert_eq!(14f64, Vec3::dot(&amp;vec7, &amp;vec1));
        assert_eq!(Vec3::from(1f64, -2f64, 1f64), Vec3::cross(&amp;vec3, &amp;vec1));
        assert_eq!(
            Vec3::from(1f64 / 3f64, 2f64 / 3f64, 2f64 / 3f64),
            Vec3::from(1f64, 2f64, 2f64).unit_vector()
        )
    }
<span class="boring">}</span></code></pre></pre>
<h2 id="color-utility-functions"><a class="header" href="#color-utility-functions">Color Utility Functions</a></h2>
<p>Using our <code>Vec3</code> struct, we'll create a utility function to write a
single pixel's color out to the standard output stream.</p>
<p>Write the following code to a new file called color.rs, add <code>mod color;</code> to
the top of main again.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use crate::vec3::*;

pub fn write_color&lt;T: std::io::Write&gt;(mut fmt: T, pixel_color: Color) -&gt; std::io::Result&lt;()&gt; {
    fmt.write_fmt(format_args!(
        &quot;{} {} {}\n&quot;,
        (255.999 * pixel_color.x()) as i32,
        (255.999 * pixel_color.y()) as i32,
        (255.999 * pixel_color.z()) as i32
    ))
}


<span class="boring">}</span></code></pre></pre>
<p>Now we can change our main to use this:</p>
<pre><pre class="playground"><code class="language-rust">use crate::color::*;
use crate::vec3::*;

mod color;
mod vec3;

fn main() {
    const IMAGE_WIDTH: i32 = 256;
    const IMAGE_HEIGHT: i32 = 256;

    println!(&quot;P3\n{IMAGE_WIDTH} {IMAGE_HEIGHT}\n255&quot;);

    for j in (0..IMAGE_HEIGHT).rev() {
        eprintln!(&quot;\rScanlines remaining: {j}&quot;);
        for i in 0..IMAGE_WIDTH {
            let pixel_color: Color = Color::from(
                (i as f64) / (IMAGE_WIDTH as f64 - 1f64),
                (j as f64) / (IMAGE_HEIGHT as f64 - 1f64),
                0.25,
            );

            write_color(std::io::stdout(), pixel_color).unwrap();
        }
    }
    eprintln!(&quot;\nDone&quot;);
}
</code></pre></pre>
<p>This should be able to generate the same output as the previous Chapter.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../chapters/chapter_1.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../chapters/chapter_3.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../chapters/chapter_1.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../chapters/chapter_3.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src=".././theme/sidebar.js"></script>


    </body>
</html>
